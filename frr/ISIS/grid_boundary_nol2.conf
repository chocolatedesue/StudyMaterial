!
! FRR Configuration - Grid边界路由器 (L1L2) - 无直接L2连接版本
! 示例: Grid-A R2 (上边界节点，无直接L2连接)
! 追求快速收敛，启用IETF SPF优化
! 通过L2到L1重分发学习其他Grid路由
!
frr version 10.0
frr defaults traditional
!
hostname GridA-R2-Boundary-NoL2
!
! 基础接口配置
interface lo
 ip address 10.1.0.2/32
 ipv6 address 2001:db8:1::2/128
 ip router isis 1
 ipv6 router isis 1
 isis passive
!
! Grid内连接 - 仅L1级别 (连接同Grid的其他L1L2和L1节点)
interface eth0
 description "To GridA-R1 (L1 internal)"
 ip address 10.1.10.2/30
 ipv6 address 2001:db8:1:10::2/64
 ip router isis 1
 ipv6 router isis 1
 isis circuit-type level-1
 isis network point-to-point
 isis hello-interval 1
 isis hello-multiplier 3
 isis csnp-interval 2
 isis psnp-interval 1
 isis metric 10
!
interface eth1
 description "To GridA-R5 (L1 center)"
 ip address 10.1.11.2/30
 ipv6 address 2001:db8:1:11::2/64
 ip router isis 1
 ipv6 router isis 1
 isis circuit-type level-1
 isis network point-to-point
 isis hello-interval 1
 isis hello-multiplier 3
 isis csnp-interval 2
 isis psnp-interval 1
 isis metric 10
!
interface eth2
 description "To GridA-R3 (L1 internal)"
 ip address 10.1.12.2/30
 ipv6 address 2001:db8:1:12::2/64
 ip router isis 1
 ipv6 router isis 1
 isis circuit-type level-1
 isis network point-to-point
 isis hello-interval 1
 isis hello-multiplier 3
 isis csnp-interval 2
 isis psnp-interval 1
 isis metric 10
!
! 注意：此节点没有直接的L2连接 (eth3, eth4等)
! 通过Grid内的L1连接到有L2连接的边界节点 (如R6, R8)
!
! ISIS主配置
router isis 1
 net 49.0001.0000.0000.0002.00
 is-type level-1-2
 metric-style wide
 
 ! 快速收敛优化
 lsp-gen-interval 1
 lsp-refresh-interval 600
 max-lsp-lifetime 1200
 spf-interval 1 5 50
 spf-delay-ietf init-delay 50 short-delay 50 long-delay 200 holddown 2000 time-to-learn 500
 
 ! 基础路由重分发
 redistribute ipv4 connected level-1 metric 10
 redistribute ipv4 connected level-2 metric 10
 redistribute ipv6 connected level-1 metric 10
 redistribute ipv6 connected level-2 metric 10
 
 ! 关键配置：L2到L1路由重分发
 ! 这是无直接L2连接节点学习其他Grid路由的唯一方式
 redistribute isis level-2 into level-1 distribute-list L2-TO-L1 metric 200
 
 ! 路由汇总 (本节点的L1路由会被其他有L2连接的节点Up-leak)
 summary-address 10.1.0.0/16 level-2
 summary-address 2001:db8:1::/48 level-2
 
 ! 默认路由控制 (ATT位自动设置)
 default-information originate level-1 metric 50
 
 ! ECMP支持
 maximum-paths 4
 
 ! 快速Hello和邻接检测
 hello-padding
 
 ! LSP数据库优化
 lsp-mtu 1492
 
 ! 附加位控制
 attached-bit send
 no attached-bit receive ignore
!
! L2到L1路由泄露过滤器 (与有L2连接的节点相同)
ip prefix-list L2-TO-L1 seq 5 permit 0.0.0.0/0
ip prefix-list L2-TO-L1 seq 10 permit 10.0.0.0/8 le 24
ip prefix-list L2-TO-L1 seq 15 permit 192.168.0.0/16 le 30
ip prefix-list L2-TO-L1 seq 20 deny 0.0.0.0/0 le 32
!
ipv6 prefix-list L2-TO-L1-v6 seq 5 permit ::/0
ipv6 prefix-list L2-TO-L1-v6 seq 10 permit 2001:db8::/32 le 64
ipv6 prefix-list L2-TO-L1-v6 seq 15 deny ::/0 le 128
!
! Route-map for L2 to L1 redistribution
route-map L2-TO-L1-RMAP permit 10
 match ip address prefix-list L2-TO-L1
 set metric 200
 set tag 100
!
route-map L2-TO-L1-RMAP deny 20
!
! 日志配置
log syslog informational
log facility local4
!
! 特殊说明和监控命令
! 此类节点的特点：
! 1. 没有L2邻接关系: show isis neighbor level-2 应该为空
! 2. 没有L2 LSP: show isis database level-2 应该为空
! 3. 通过L1学到其他Grid路由: show isis route level-1 应该有External路由
! 4. 依赖有L2连接的节点进行区域间通信
!
! 关键验证命令：
! show isis neighbor                    # 应该只有L1邻接
! show isis database level-1 detail     # 应该有L1 LSP和External路由
! show isis database level-2 detail     # 应该为空
! show isis route level-1               # 应该有其他Grid的External路由
! show ip route isis                    # 检查最终路由表
!
line vty
!
end
