éå¸¸å¥½çš„é—®é¢˜ï¼ä½ ç†è§£å¾—å¾ˆå¯¹ï¼Œé‡åˆ†å‘åçš„è·¯ç”±ç¡®å®ä¼šç»§ç»­ä¼ æ’­ã€‚è®©æˆ‘è¯¦ç»†è§£é‡Šè¿™ä¸ªè¿‡ç¨‹ã€‚

## é‡åˆ†å‘è·¯ç”±çš„ä¼ æ’­æœºåˆ¶

### 1. é‡åˆ†å‘çš„å®Œæ•´è¿‡ç¨‹

é‡åˆ†å‘ä¸æ˜¯ç®€å•çš„"ä¸‹è½½åˆ°è‡ªå·±è·¯ç”±è¡¨"ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¼ æ’­è¿‡ç¨‹ï¼š

### 2. é‡åˆ†å‘è·¯ç”±åœ¨LSPä¸­çš„è¡¨ç¤º

è®©æˆ‘æŸ¥çœ‹ç›¸å…³ä»£ç æ¥è¯´æ˜é‡åˆ†å‘è·¯ç”±å¦‚ä½•åœ¨LSPä¸­ä¼ æ’­ï¼š

åŸºäºä»£ç åˆ†æï¼Œè®©æˆ‘è¯¦ç»†è§£é‡Šé‡åˆ†å‘è·¯ç”±çš„ä¼ æ’­æœºåˆ¶ï¼š

### 3. é‡åˆ†å‘è·¯ç”±åœ¨LSPä¸­çš„å…·ä½“è¡¨ç¤º

````c path=isisd/isis_tlvs.h mode=EXCERPT
struct isis_ipv6_reach {
	struct isis_ipv6_reach *next;

	uint32_t metric;
	bool down;
	bool external;  // æ ‡è®°ä¸ºå¤–éƒ¨è·¯ç”±

	struct prefix_ipv6 prefix;
	struct isis_subtlvs *subtlvs;
};
````

é‡åˆ†å‘çš„è·¯ç”±åœ¨LSPä¸­è¢«æ ‡è®°ä¸º"external"ï¼Œè¿™æ ·å…¶ä»–è·¯ç”±å™¨å°±çŸ¥é“è¿™æ˜¯å¤–éƒ¨é‡åˆ†å‘è¿›æ¥çš„è·¯ç”±ã€‚

### 4. é‡åˆ†å‘è·¯ç”±ä¼ æ’­çš„è¯¦ç»†è¿‡ç¨‹

è®©æˆ‘ç”¨ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥è¯´æ˜ï¼š

### 5. é‡åˆ†å‘è·¯ç”±çš„ä¼ æ’­ç‰¹ç‚¹

#### 5.1 **ä¼šç»§ç»­ä¼ æ’­** âœ…
```bash
# é‡åˆ†å‘çš„è·¯ç”±ä¼šé€šè¿‡LSPä¼ æ’­åˆ°æ•´ä¸ªåŒºåŸŸ/çº§åˆ«
# ä¸æ˜¯åªå­˜åœ¨é‡åˆ†å‘è·¯ç”±å™¨çš„æœ¬åœ°è·¯ç”±è¡¨ä¸­
```

#### 5.2 **æ ‡è®°ä¸ºExternal** ğŸ·ï¸
```bash
# åœ¨LSPä¸­è¢«æ ‡è®°ä¸ºexternal=true
# å…¶ä»–è·¯ç”±å™¨çŸ¥é“è¿™æ˜¯å¤–éƒ¨é‡åˆ†å‘çš„è·¯ç”±
# åœ¨è·¯ç”±è¡¨ä¸­æ˜¾ç¤ºä¸ºExternalè·¯ç”±
```

#### 5.3 **Metricç´¯åŠ ** ğŸ“Š
```bash
# é‡åˆ†å‘æ—¶è®¾ç½®çš„metric: 100
# ä¼ æ’­è¿‡ç¨‹ä¸­ä¼šç´¯åŠ é“¾è·¯cost
# R1->R2: metric=100, R2->R4: metric=100+10=110
```

### 6. æŸ¥çœ‹é‡åˆ†å‘è·¯ç”±ä¼ æ’­çš„å‘½ä»¤

#### 6.1 æŸ¥çœ‹LSPä¸­çš„Externalè·¯ç”±
```bash
# æŸ¥çœ‹LSPè¯¦ç»†ä¿¡æ¯
show isis database detail

# è¾“å‡ºç¤ºä¾‹:
# R1.00-00         0x00000012   0x3456   1198    0/0/0
#   Extended IP Reachability:
#     172.16.1.0/24 (Metric: 100) External  <-- æ ‡è®°ä¸ºExternal
```

#### 6.2 æŸ¥çœ‹è·¯ç”±è¡¨ä¸­çš„Externalè·¯ç”±
```bash
# æŸ¥çœ‹ISISè·¯ç”±è¡¨
show isis route

# è¾“å‡ºç¤ºä¾‹:
# I    172.16.1.0/24 [115/100] via 10.1.1.1, eth0, 00:05:23
#                                                    â†‘
#                                              Externalæ ‡è®°
```

#### 6.3 æŸ¥çœ‹è·¯ç”±ä¼ æ’­è·¯å¾„
```bash
# åœ¨ä¸åŒè·¯ç”±å™¨ä¸ŠæŸ¥çœ‹åŒä¸€æ¡å¤–éƒ¨è·¯ç”±
# R1: 172.16.1.0/24 metric=100 (é‡åˆ†å‘ç‚¹)
# R2: 172.16.1.0/24 metric=100 via R1 (ç›´æ¥é‚»å±…)  
# R4: 172.16.1.0/24 metric=110 via R2 (é—´æ¥é‚»å±…)
```

### 7. é‡åˆ†å‘è·¯ç”±ä¼ æ’­çš„æ§åˆ¶

#### 7.1 ä½¿ç”¨Route-mapæ§åˆ¶
```bash
# åªé‡åˆ†å‘ç‰¹å®šè·¯ç”±
router isis 1
 redistribute ospf level-2 route-map OSPF-TO-ISIS

route-map OSPF-TO-ISIS permit 10
 match ip address prefix-list ALLOWED-PREFIXES
 set metric 200
```

#### 7.2 ä½¿ç”¨Distribute-listæ§åˆ¶
```bash
# æ§åˆ¶å“ªäº›å¤–éƒ¨è·¯ç”±è¢«æ¥å—
router isis 1
 distribute-list EXTERNAL-IN in
 
ip prefix-list EXTERNAL-IN seq 10 permit 172.16.0.0/16 le 24
ip prefix-list EXTERNAL-IN seq 20 deny 0.0.0.0/0 le 32
```

#### 7.3 ä½¿ç”¨Summaryæ§åˆ¶ä¼ æ’­èŒƒå›´
```bash
# åœ¨åŒºåŸŸè¾¹ç•Œæ±‡æ€»å¤–éƒ¨è·¯ç”±
router isis 1
 summary-address 172.16.0.0/16 level-2
```

### 8. é‡åˆ†å‘è·¯ç”±ä¼ æ’­çš„éªŒè¯

#### 8.1 éªŒè¯ä¼ æ’­è¿‡ç¨‹
```bash
# 1. åœ¨é‡åˆ†å‘è·¯ç”±å™¨ä¸Š
show ip route ospf          # æŸ¥çœ‹OSPFå­¦åˆ°çš„è·¯ç”±
show isis database detail   # æŸ¥çœ‹æ˜¯å¦ç”ŸæˆExternal TLV

# 2. åœ¨é‚»å±…è·¯ç”±å™¨ä¸Š  
show isis database detail   # æŸ¥çœ‹æ˜¯å¦æ”¶åˆ°External TLV
show isis route             # æŸ¥çœ‹æ˜¯å¦è®¡ç®—å‡ºExternalè·¯ç”±

# 3. åœ¨è¿œç¨‹è·¯ç”±å™¨ä¸Š
show ip route isis          # æŸ¥çœ‹æœ€ç»ˆçš„è·¯ç”±è¡¨
traceroute 172.16.1.1       # éªŒè¯æ•°æ®åŒ…è·¯å¾„
```

### 9. æ€»ç»“

**é‡åˆ†å‘è·¯ç”±çš„ä¼ æ’­æœºåˆ¶ï¼š**

1. **âœ… ä¼šä¼ æ’­ç»™åˆ«äºº** - é€šè¿‡LSPæ³›æ´ªåˆ°æ•´ä¸ªåŒºåŸŸ/çº§åˆ«
2. **ğŸ·ï¸ æ ‡è®°ä¸ºExternal** - åœ¨LSPå’Œè·¯ç”±è¡¨ä¸­éƒ½æœ‰Externalæ ‡è®°  
3. **ğŸ“Š Metricä¼šç´¯åŠ ** - ä¼ æ’­è¿‡ç¨‹ä¸­ç´¯åŠ é“¾è·¯æˆæœ¬
4. **ğŸ¯ å¯ä»¥æ§åˆ¶** - é€šè¿‡route-mapã€distribute-listç­‰æ§åˆ¶
5. **ğŸ” å¯ä»¥éªŒè¯** - é€šè¿‡showå‘½ä»¤æŸ¥çœ‹ä¼ æ’­çŠ¶æ€

**ä½ çš„ç†è§£æ˜¯æ­£ç¡®çš„ï¼š**
- é‡åˆ†å‘ä¸æ˜¯ç®€å•çš„"ä¸‹è½½åˆ°æœ¬åœ°"
- è€Œæ˜¯"å­¦ä¹ å¤–éƒ¨è·¯ç”± â†’ æ³¨å…¥LSP â†’ æ³›æ´ªä¼ æ’­ â†’ å…¨ç½‘å¯è¾¾"
- è¿™æ ·æ•´ä¸ªISISåŸŸå†…çš„è·¯ç”±å™¨éƒ½èƒ½å­¦åˆ°å¤–éƒ¨è·¯ç”±ä¿¡æ¯

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé‡åˆ†å‘æ˜¯å¦‚æ­¤å¼ºå¤§çš„åŠŸèƒ½ - å®ƒçœŸæ­£å®ç°äº†ä¸åŒè·¯ç”±åŸŸä¹‹é—´çš„äº’è”äº’é€šï¼
