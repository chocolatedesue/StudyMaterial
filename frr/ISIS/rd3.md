éå¸¸å¥½çš„é—®é¢˜ï¼ISISè‡ªå·±çš„L1/L2é‡åˆ†å‘æ˜¯ä¸€ä¸ªç‰¹æ®Šä¸”é‡è¦çš„æœºåˆ¶ï¼Œè®©æˆ‘è¯¦ç»†è§£é‡Šè¿™ä¸ªè¿‡ç¨‹ã€‚

## ISIS L1/L2é‡åˆ†å‘æœºåˆ¶è¯¦è§£

### 1. ISIS L1/L2é‡åˆ†å‘çš„æœ¬è´¨

è¿™ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„"å¤–éƒ¨åè®®é‡åˆ†å‘"ï¼Œè€Œæ˜¯**åŒä¸€ä¸ªISISè¿›ç¨‹å†…éƒ¨çš„çº§åˆ«é—´è·¯ç”±æ³„éœ²**ï¼š

### 2. L1åˆ°L2çš„Up-leaking (è‡ªåŠ¨å‘ç”Ÿ)

#### 2.1 ä»€ä¹ˆæ•°æ®è¢«åˆ†å‘ï¼Ÿ
```bash
# L1L2è·¯ç”±å™¨è‡ªåŠ¨å°†L1å­¦åˆ°çš„è·¯ç”±æ³„éœ²åˆ°L2
# åŒ…æ‹¬ï¼š
- L1åŒºåŸŸå†…çš„æ‰€æœ‰å†…éƒ¨è·¯ç”±
- L1åŒºåŸŸå†…é‡åˆ†å‘çš„å¤–éƒ¨è·¯ç”±
- Connectedè·¯ç”± (å¦‚æœé…ç½®äº†redistribute connected level-1)
```

#### 2.2 åˆ†å‘åˆ°å“ªé‡Œï¼Ÿ
```bash
# åˆ†å‘åˆ°L2çº§åˆ«ï¼Œä½œä¸ºExternalè·¯ç”±
# ä¼ æ’­èŒƒå›´ï¼šæ•´ä¸ªL2éª¨å¹²ç½‘ç»œ
# å…¶ä»–åŒºåŸŸçš„L1L2è·¯ç”±å™¨éƒ½èƒ½å­¦åˆ°
```

è®©æˆ‘æŸ¥çœ‹ç›¸å…³ä»£ç æ¥ç¡®è®¤è¿™ä¸ªæœºåˆ¶ï¼š

ç°åœ¨è®©æˆ‘æŸ¥æ‰¾æ›´å…·ä½“çš„L1åˆ°L2è·¯ç”±æ³„éœ²æœºåˆ¶ï¼š

ç°åœ¨è®©æˆ‘è¯¦ç»†è§£é‡ŠISIS L1/L2é‡åˆ†å‘æœºåˆ¶ï¼š

### 3. L1åˆ°L2çš„Up-leakingè¯¦ç»†è¿‡ç¨‹

### 4. L2åˆ°L1çš„Down-leakingè¯¦ç»†è¿‡ç¨‹

### 5. å…·ä½“çš„é…ç½®å’Œæ•°æ®æµ

#### 5.1 L1åˆ°L2 Up-leaking (è‡ªåŠ¨å‘ç”Ÿ)
```bash
# æ— éœ€é…ç½®ï¼ŒL1L2è·¯ç”±å™¨è‡ªåŠ¨æ‰§è¡Œ
# æ•°æ®æµï¼šL1è·¯ç”± â†’ L1L2è·¯ç”±å™¨ â†’ L2 External Reach â†’ å…¨ç½‘L2ä¼ æ’­

# ä»€ä¹ˆæ•°æ®è¢«Up-leakï¼Ÿ
- Gridå†…L1è·¯ç”±å™¨çš„Loopbackåœ°å€
- Gridå†…é‡åˆ†å‘çš„Connectedè·¯ç”±  
- Gridå†…é‡åˆ†å‘çš„å¤–éƒ¨è·¯ç”±
- æ‰€æœ‰åœ¨L1çº§åˆ«å­¦åˆ°çš„è·¯ç”±

# åˆ†å‘åˆ°å“ªé‡Œï¼Ÿ
- L2çº§åˆ«çš„LSPä¸­ï¼Œä½œä¸ºExternal Reachability TLV
- ä¼ æ’­åˆ°æ•´ä¸ªL2éª¨å¹²ç½‘ç»œ
- å…¶ä»–æ‰€æœ‰Gridçš„L1L2è·¯ç”±å™¨éƒ½èƒ½å­¦åˆ°

# è¿˜ä¼šä¼ æ’­å—ï¼Ÿ
- âœ… ä¼šï¼é€šè¿‡L2 LSPæ³›æ´ªåˆ°æ‰€æœ‰L2è·¯ç”±å™¨
- æˆä¸ºå…¶ä»–Gridçš„Externalè·¯ç”±
- å¯ä»¥è¢«å…¶ä»–Gridçš„L1L2è·¯ç”±å™¨Down-leakåˆ°å„è‡ªçš„L1åŒºåŸŸ
```

#### 5.2 L2åˆ°L1 Down-leaking (éœ€è¦é…ç½®)
```bash
# éœ€è¦æ˜¾å¼é…ç½®
router isis 1
 redistribute isis level-2 into level-1 distribute-list L2-TO-L1

# é…ç½®è¿‡æ»¤å™¨
ip prefix-list L2-TO-L1 seq 10 permit 10.0.0.0/8 le 24
ip prefix-list L2-TO-L1 seq 20 deny 0.0.0.0/0 le 32

# ä»€ä¹ˆæ•°æ®è¢«Down-leakï¼Ÿ
- å…¶ä»–Gridçš„L1è·¯ç”± (é€šè¿‡L2å­¦åˆ°çš„)
- å¤–éƒ¨é‡åˆ†å‘åˆ°L2çš„è·¯ç”±
- ç¬¦åˆè¿‡æ»¤å™¨æ¡ä»¶çš„L2è·¯ç”±

# åˆ†å‘åˆ°å“ªé‡Œï¼Ÿ
- æœ¬åœ°L1çº§åˆ«çš„LSPä¸­ï¼Œä½œä¸ºExternal Reachability TLV
- ä»…åœ¨æœ¬Gridå†…ä¼ æ’­
- æœ¬Gridçš„L1è·¯ç”±å™¨å¯ä»¥å­¦åˆ°

# è¿˜ä¼šä¼ æ’­å—ï¼Ÿ
- âœ… ä¼šï¼ä½†ä»…åœ¨æœ¬Gridçš„L1çº§åˆ«ä¼ æ’­
- ä¸ä¼šå†æ¬¡Up-leakåˆ°L2 (é˜²æ­¢ç¯è·¯)
- æœ¬Gridå†…çš„L1è·¯ç”±å™¨éƒ½èƒ½å­¦åˆ°
```

### 6. æ•°æ®ä¼ æ’­çš„å®Œæ•´ç¤ºä¾‹

è®©æˆ‘ç”¨ä¸€ä¸ªå…·ä½“ä¾‹å­è¯´æ˜ï¼š

### 7. é…ç½®ç¤ºä¾‹å’ŒéªŒè¯

#### 7.1 L2åˆ°L1é‡åˆ†å‘é…ç½®
```bash
# è¾¹ç•Œè·¯ç”±å™¨é…ç½®
router isis 1
 net 49.0001.0000.0000.0006.00
 is-type level-1-2
 
 # L2åˆ°L1é‡åˆ†å‘ (å¯é€‰)
 redistribute isis level-2 into level-1 distribute-list L2-TO-L1 metric 200
 
# è¿‡æ»¤å™¨é…ç½®
ip prefix-list L2-TO-L1 seq 5 permit 0.0.0.0/0
ip prefix-list L2-TO-L1 seq 10 permit 10.0.0.0/8 le 24
ip prefix-list L2-TO-L1 seq 15 deny 192.168.0.0/16 le 32
ip prefix-list L2-TO-L1 seq 20 deny 0.0.0.0/0 le 32
```

#### 7.2 éªŒè¯å‘½ä»¤
```bash
# æŸ¥çœ‹L1/L2é‡åˆ†å‘çŠ¶æ€
show isis database detail

# æŸ¥çœ‹Up-leakçš„è·¯ç”± (åœ¨L2 LSPä¸­)
show isis database level-2 detail | grep "IP.*External"

# æŸ¥çœ‹Down-leakçš„è·¯ç”± (åœ¨L1 LSPä¸­)  
show isis database level-1 detail | grep "IP.*External"

# æŸ¥çœ‹è·¯ç”±è¡¨ä¸­çš„Externalè·¯ç”±
show isis route | grep "E"
show ip route isis | grep "E"
```

### 8. æ€»ç»“

**ISIS L1/L2é‡åˆ†å‘çš„æ ¸å¿ƒç†è§£ï¼š**

1. **Up-leaking (L1â†’L2)**ï¼š
   - âœ… **è‡ªåŠ¨å‘ç”Ÿ**ï¼Œæ— éœ€é…ç½®
   - ğŸ“¤ **æ•°æ®**ï¼šL1åŒºåŸŸå†…çš„æ‰€æœ‰è·¯ç”±
   - ğŸ¯ **ç›®æ ‡**ï¼šL2çº§åˆ«ï¼Œä½œä¸ºExternalè·¯ç”±
   - ğŸŒ **ä¼ æ’­**ï¼šå…¨ç½‘L2ä¼ æ’­

2. **Down-leaking (L2â†’L1)**ï¼š
   - âš™ï¸ **éœ€è¦é…ç½®**ï¼š`redistribute isis level-2 into level-1`
   - ğŸ“¥ **æ•°æ®**ï¼šL2çº§åˆ«å­¦åˆ°çš„å…¶ä»–åŒºåŸŸè·¯ç”±
   - ğŸ¯ **ç›®æ ‡**ï¼šæœ¬åœ°L1çº§åˆ«ï¼Œä½œä¸ºExternalè·¯ç”±
   - ğŸ  **ä¼ æ’­**ï¼šä»…æœ¬åŒºåŸŸL1ä¼ æ’­

3. **ä¼ æ’­ç‰¹æ€§**ï¼š
   - âœ… **éƒ½ä¼šä¼ æ’­**ï¼šé€šè¿‡LSPæœºåˆ¶ä¼ æ’­
   - ğŸ·ï¸ **æ ‡è®°ä¸ºExternal**ï¼šåœ¨LSPå’Œè·¯ç”±è¡¨ä¸­æ ‡è®°
   - ğŸ”„ **é˜²æ­¢ç¯è·¯**ï¼šDown-leakçš„è·¯ç”±ä¸ä¼šå†Up-leak
   - ğŸ›ï¸ **å¯ä»¥æ§åˆ¶**ï¼šé€šè¿‡distribute-listå’Œroute-mapè¿‡æ»¤

è¿™å°±æ˜¯ISISå¤šåŒºåŸŸæ¶æ„çš„ç²¾é«“ - é€šè¿‡L1L2è·¯ç”±å™¨çš„è‡ªåŠ¨Up-leakå’Œå¯é€‰çš„Down-leakï¼Œå®ç°äº†åŒºåŸŸé—´çš„è·¯ç”±ä¿¡æ¯äº¤æ¢å’Œè¿é€šæ€§ï¼
