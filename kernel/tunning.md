åŸºäºä½ æ‰“å¼€çš„æ–‡ä»¶å’Œæˆ‘åˆšæ‰åˆ›å»ºçš„è„šæœ¬ï¼Œè®©æˆ‘è¯¦ç»†è§£é‡Šè¿™ä¸‰ä¸ªè°ƒä¼˜è„šæœ¬çš„åŒºåˆ«ï¼š

## ä¸‰ä¸ªè„šæœ¬çš„åŠŸèƒ½å®šä½

### 1. `host-kernel-tuning.sh` - ä¸»æœºçº§å†…æ ¸è°ƒä¼˜
**ä½œç”¨èŒƒå›´**ï¼šæ•´ä¸ªä¸»æœºç³»ç»Ÿ
**è°ƒä¼˜å±‚çº§**ï¼šç³»ç»Ÿçº§ï¼ˆå½±å“æ‰€æœ‰è¿›ç¨‹å’Œå®¹å™¨ï¼‰

````bash path=scripts/kernel-tuning/host-kernel-tuning.sh mode=EXCERPT
# ä¸»è¦è°ƒä¼˜å†…å®¹ï¼š
sysctl -w kernel.pty.max=131072                    # ç³»ç»Ÿçº§PTYé™åˆ¶
sysctl -w net.ipv4.ip_forward=1                    # å…¨å±€IPè½¬å‘
sysctl -w net.ipv4.neigh.default.gc_thresh1=1048576 # å…¨å±€é‚»å±…è¡¨
sysctl -w net.nf_conntrack_max=262144              # å…¨å±€è¿æ¥è·Ÿè¸ª
````

### 2. `container-kernel-tuning.sh` - å®¹å™¨/å‘½åç©ºé—´è°ƒä¼˜
**ä½œç”¨èŒƒå›´**ï¼šå•ä¸ªç½‘ç»œå‘½åç©ºé—´
**è°ƒä¼˜å±‚çº§**ï¼šå‘½åç©ºé—´çº§ï¼ˆä»…å½±å“ç‰¹å®šå®¹å™¨ï¼‰

````bash path=scripts/kernel-tuning/container-kernel-tuning.sh mode=EXCERPT
# ä¸»è¦è°ƒä¼˜å†…å®¹ï¼š
ip netns exec "$netns_name" sysctl -w net.ipv6.conf.all.disable_ipv6=1  # å‘½åç©ºé—´å†…IPv6
ip netns exec "$netns_name" sysctl -w net.ipv4.ip_forward=1              # å‘½åç©ºé—´å†…è½¬å‘
ip netns exec "$netns_name" ip link set lo up                            # å‘½åç©ºé—´å†…æ¥å£
````

### 3. `reals-kernel-tuning.sh` - å®Œæ•´ç³»ç»Ÿè°ƒä¼˜
**ä½œç”¨èŒƒå›´**ï¼šåè°ƒå‰ä¸¤ä¸ªè„šæœ¬
**è°ƒä¼˜å±‚çº§**ï¼šç³»ç»Ÿç®¡ç†çº§ï¼ˆç¼–æ’å’Œç®¡ç†ï¼‰

````bash path=scripts/kernel-tuning/reals-kernel-tuning.sh mode=EXCERPT
# ä¸»è¦åŠŸèƒ½ï¼š
"$HOST_SCRIPT" apply                                # è°ƒç”¨ä¸»æœºçº§è„šæœ¬
"$CONTAINER_SCRIPT" bulk ".*" "$disable_ipv6"      # æ‰¹é‡è°ƒç”¨å®¹å™¨çº§è„šæœ¬
````

## è¯¦ç»†åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | host-kernel-tuning.sh | container-kernel-tuning.sh | reals-kernel-tuning.sh |
|---------|----------------------|---------------------------|------------------------|
| **è°ƒä¼˜èŒƒå›´** | æ•´ä¸ªä¸»æœºç³»ç»Ÿ | å•ä¸ªç½‘ç»œå‘½åç©ºé—´ | åè°ƒä¸¤è€… |
| **æŒä¹…åŒ–** | âœ… è‡ªåŠ¨æŒä¹…åŒ–åˆ° `/etc/sysctl.d/` | âŒ éœ€è¦é‡æ–°åº”ç”¨ | âœ… ç®¡ç†æŒä¹…åŒ– |
| **å½±å“é‡å¯** | âœ… é‡å¯åè‡ªåŠ¨ç”Ÿæ•ˆ | âŒ é‡å¯åå¤±æ•ˆ | âœ… ç®¡ç†é‡å¯è¡Œä¸º |
| **èµ„æºé™åˆ¶** | âœ… PTYã€å†…å­˜ã€è¿æ¥æ•° | âŒ ä¸æ¶‰åŠ | âœ… é€šè¿‡hostè„šæœ¬ |
| **ç½‘ç»œè½¬å‘** | âœ… å…¨å±€IPv4/IPv6è½¬å‘ | âœ… å‘½åç©ºé—´å†…è½¬å‘ | âœ… åè°ƒä¸¤è€… |
| **é‚»å±…è¡¨** | âœ… å…¨å±€ARP/NDPç¼“å­˜ | âŒ ç»§æ‰¿ä¸»æœºè®¾ç½® | âœ… é€šè¿‡hostè„šæœ¬ |
| **IPv6ç®¡ç†** | âœ… å…¨å±€IPv6ç­–ç•¥ | âœ… æŒ‰å‘½åç©ºé—´æ§åˆ¶ | âœ… ç»Ÿä¸€ç®¡ç† |
| **æ¥å£é…ç½®** | âŒ ä¸æ¶‰åŠå…·ä½“æ¥å£ | âœ… loopbackç­‰æ¥å£ | âœ… é€šè¿‡containerè„šæœ¬ |
| **æ‰¹é‡æ“ä½œ** | âŒ å•æ¬¡å…¨å±€åº”ç”¨ | âœ… æ”¯æŒæ‰¹é‡å‘½åç©ºé—´ | âœ… ç¼–æ’æ‰¹é‡æ“ä½œ |

## ä½¿ç”¨åœºæ™¯åŒºåˆ«

### ğŸ  Hostè„šæœ¬ä½¿ç”¨åœºæ™¯
```bash
# ç³»ç»Ÿåˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡
sudo ./host-kernel-tuning.sh apply

# é€‚ç”¨äºï¼š
# - æ–°æœåŠ¡å™¨éƒ¨ç½²
# - ç³»ç»Ÿçº§æ€§èƒ½ä¼˜åŒ–
# - ä¸ºå¤§è§„æ¨¡å®¹å™¨åšå‡†å¤‡
```

### ğŸ“¦ Containerè„šæœ¬ä½¿ç”¨åœºæ™¯
```bash
# æ¯æ¬¡åˆ›å»ºå®¹å™¨/å‘½åç©ºé—´æ—¶è¿è¡Œ
sudo ./container-kernel-tuning.sh apply node-1

# é€‚ç”¨äºï¼š
# - åŠ¨æ€åˆ›å»ºç½‘ç»œèŠ‚ç‚¹
# - ç‰¹å®šå®¹å™¨çš„ç½‘ç»œé…ç½®
# - IPv6å¯ç”¨/ç¦ç”¨æ§åˆ¶
```

### ğŸ›ï¸ REALSä¸»æ§è„šæœ¬ä½¿ç”¨åœºæ™¯
```bash
# ä¸€é”®å®Œæˆæ‰€æœ‰è°ƒä¼˜
sudo ./reals-kernel-tuning.sh apply

# é€‚ç”¨äºï¼š
# - å®Œæ•´ç³»ç»Ÿéƒ¨ç½²
# - è‡ªåŠ¨åŒ–è¿ç»´
# - ç»Ÿä¸€ç®¡ç†å’Œç›‘æ§
```

## è°ƒä¼˜å†…å®¹çš„å±‚æ¬¡å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Host Level (host-kernel-tuning.sh)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å…¨å±€è®¾ç½®ï¼ˆå½±å“æ‰€æœ‰å®¹å™¨ï¼‰:                              â”‚    â”‚
â”‚  â”‚ â€¢ kernel.pty.max=131072                            â”‚    â”‚
â”‚  â”‚ â€¢ net.ipv4.neigh.default.gc_thresh*=8M             â”‚    â”‚
â”‚  â”‚ â€¢ net.nf_conntrack_max=262144                      â”‚    â”‚
â”‚  â”‚ â€¢ net.ipv4.route.gc_thresh=-1                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ ç»§æ‰¿
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Container Level (container-kernel-tuning.sh)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   NetNS-1       â”‚  â”‚   NetNS-2       â”‚  â”‚   NetNS-N    â”‚ â”‚
â”‚  â”‚ å‘½åç©ºé—´ç‰¹å®šè®¾ç½®: â”‚  â”‚ å‘½åç©ºé—´ç‰¹å®šè®¾ç½®: â”‚  â”‚ å‘½åç©ºé—´ç‰¹å®šè®¾ç½®:â”‚ â”‚
â”‚  â”‚ â€¢ IPv6 on/off   â”‚  â”‚ â€¢ IPv6 on/off   â”‚  â”‚ â€¢ IPv6 on/offâ”‚ â”‚
â”‚  â”‚ â€¢ è½¬å‘æ§åˆ¶       â”‚  â”‚ â€¢ è½¬å‘æ§åˆ¶       â”‚  â”‚ â€¢ è½¬å‘æ§åˆ¶    â”‚ â”‚
â”‚  â”‚ â€¢ æ¥å£çŠ¶æ€       â”‚  â”‚ â€¢ æ¥å£çŠ¶æ€       â”‚  â”‚ â€¢ æ¥å£çŠ¶æ€    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ ç®¡ç†å’Œåè°ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Management Level (reals-kernel-tuning.sh)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ç¼–æ’å’Œç®¡ç†:                                          â”‚    â”‚
â”‚  â”‚ â€¢ è°ƒç”¨hostè„šæœ¬è¿›è¡Œç³»ç»Ÿçº§è°ƒä¼˜                          â”‚    â”‚
â”‚  â”‚ â€¢ æ‰¹é‡è°ƒç”¨containerè„šæœ¬å¤„ç†æ‰€æœ‰å‘½åç©ºé—´               â”‚    â”‚
â”‚  â”‚ â€¢ ç»Ÿä¸€éªŒè¯å’ŒçŠ¶æ€æ£€æŸ¥                                 â”‚    â”‚
â”‚  â”‚ â€¢ æä¾›é‡ç½®å’Œæ¢å¤åŠŸèƒ½                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®é™…è¿è¡Œç¤ºä¾‹

### åœºæ™¯1ï¼šæ–°ç³»ç»Ÿéƒ¨ç½²
```bash
# æ–¹å¼1ï¼šä½¿ç”¨ä¸»æ§è„šæœ¬ï¼ˆæ¨èï¼‰
sudo ./reals-kernel-tuning.sh apply

# æ–¹å¼2ï¼šåˆ†æ­¥æ‰§è¡Œ
sudo ./host-kernel-tuning.sh apply          # å…ˆåšç³»ç»Ÿçº§è°ƒä¼˜
sudo ./container-kernel-tuning.sh bulk ".*" # å†å¤„ç†æ‰€æœ‰å®¹å™¨
```

### åœºæ™¯2ï¼šåŠ¨æ€æ·»åŠ å®¹å™¨
```bash
# ç³»ç»Ÿçº§è°ƒä¼˜å·²å®Œæˆï¼Œåªéœ€å¤„ç†æ–°å®¹å™¨
sudo ./container-kernel-tuning.sh create new-router-1 false router
```

### åœºæ™¯3ï¼šæ•…éšœæ’é™¤
```bash
# æ£€æŸ¥ç³»ç»Ÿçº§è®¾ç½®
sudo ./host-kernel-tuning.sh verify

# æ£€æŸ¥ç‰¹å®šå®¹å™¨è®¾ç½®
sudo ./container-kernel-tuning.sh verify node-1

# ç»Ÿä¸€æ£€æŸ¥æ‰€æœ‰è®¾ç½®
sudo ./reals-kernel-tuning.sh verify
```

## æ€»ç»“

è¿™ä¸‰ä¸ªè„šæœ¬å½¢æˆäº†ä¸€ä¸ª**åˆ†å±‚çš„å†…æ ¸è°ƒä¼˜ä½“ç³»**ï¼š

1. **`host-kernel-tuning.sh`** = ğŸ—ï¸ **åŸºç¡€è®¾æ–½å±‚**ï¼ˆä¸€æ¬¡æ€§ç³»ç»Ÿçº§ä¼˜åŒ–ï¼‰
2. **`container-kernel-tuning.sh`** = ğŸ”§ **åº”ç”¨å±‚**ï¼ˆåŠ¨æ€å®¹å™¨çº§é…ç½®ï¼‰  
3. **`reals-kernel-tuning.sh`** = ğŸ¯ **ç®¡ç†å±‚**ï¼ˆç»Ÿä¸€ç¼–æ’å’Œæ§åˆ¶ï¼‰

è¿™ç§è®¾è®¡æ—¢ä¿è¯äº†**ç³»ç»Ÿçº§ä¼˜åŒ–çš„å…¨å±€æ€§**ï¼Œåˆæä¾›äº†**å®¹å™¨çº§é…ç½®çš„çµæ´»æ€§**ï¼ŒåŒæ—¶é€šè¿‡ä¸»æ§è„šæœ¬å®ç°äº†**è‡ªåŠ¨åŒ–ç®¡ç†**ã€‚
